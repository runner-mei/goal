---
layout: manual
title: Controllers
category: handlers
links:
  prev:
    name: More about the command for generation of handlers from controllers
    url: /manual/handlers/index.html
  next:
    name: More about actions and magic actions of controllers
    url: /manual/handlers/actions.html
---
A controller is any `struct` type that has [magic methods](#magic-method),
[actions](actions.html), and/or [magic actions](actions.html#magic-actions).

```go
// Profiles is a sample controller.
type Profiles struct {
}

// Index is a sample action.
func (c *Profiles) Index() action.Result {
	...
}
```

As part of handling HTTP request, an instance of controller will be instantiated.
Herewith no instance of controller is shared between requests.

## Inheritance
The way to inherit from some controller is to embed it anonymously as follows:

```go
type ParentController struct {
}

type ParentController2 struct {
}

type ChildController struct {
	*ParentController
	*ParentController2
}
```

**Pay attention, it is required to be embedded as  `*ParentController` rather than `ParentController`.**

It is possible to embed any number of parent controllers.
Child controller will inherit [magic methods](#magic-methods) and
[magic actions](actions.html#magic-actions) of its parent controllers.

## Magic methods
Magic methods (if presented) are executed automatically with every request.

### `Initially`
This kind of method is the first to be started after initialization of controller.

`Initially` gets two arguments of types: `http.ResponseWriter` and `*http.Request`
(both are from standard `net/http` library).
And returns `bool`: `true` if the execution of subsequent `Initially` methods,
[actions](actions.html), [magic actions](actions.html#magic-actions) should be stopped;
`false` otherwise.

```go
func (c *App) Initially(w http.ResponseWriter, r *http.Request) (finish bool) {
	...
}
```

### `Finally`
This is an equivalent of `Initially` except it is started at the very end of
request life cycle.
Important thing is `Finally` will be started no matter what:
panics of previously started `Initially` methods, [actions](actions.html),
and [magic actions](actions.html#magic-actions) will not prevent the start
of `Finally`.

However, if `Finally` method of one of the parent controllers returns `true`,
no other `Finally` methods of subsequent parent controllers and/or current controller
will be executed.

```go
func (c *App) Finally(w http.ResponseWriter, r *http.Request) bool {
	if err := recover(); err != nil {
		...
		return true
	}
	return false
}
```

### Request life cycle
Here is an overview of life cycle of a request to the handler function generated by
[`sunplate generate handlers`](index.html) command:

* Instantiation of [controller](#controllers) and its [parent controllers](#inheritance)
* Execution of [`Initially`](#initially) magic method
  * of parent controller #1 (if `true` is returned **goto FIN**)
  * ...
  * of parent controller #N (if `true` is returned **goto FIN**)
  * of current controller (if true is returned **goto FIN**)
* Execution of [`Before`](actions.html#before) [magic action](actions.html#magic-actions)
  * of parent controller #1 (if `non-nil` value is returned **goto FIN**)
  * ...
  * of parent controller #N (if `non-nil` value is returned **goto FIN**)
  * of current controller (if `non-nil` value is returned **goto FIN**)
* Execution of a requested [action](actions.html) (if `non-nil` value is returned **goto FIN**)
* Execution of [`After`](actions.html#after) [magic action](actions.html#magic-actions)
  * of parent controller #1 (if `non-nil` value is returned **goto FIN**)
  * ...
  * of parent controller #N (if `non-nil` value is returned **goto FIN**)
  * of current controller (if `non-nil` value is returned **goto FIN**)
* **label FIN**: Execution of [`Finally`](#finally) magic method
  * of parent controller #1 (if `true` is returned **exit**)
  * ...
  * of parent controller #N (if `true` is returned **exit**)
  * of current controller (if true is returned **exit**)
